# ğŸ” ç¯å¢ƒé—®é¢˜è¯Šæ–­æŠ¥å‘Š

## é—®é¢˜å‘ç°æ—¶é—´çº¿

### åˆå§‹ç—‡çŠ¶
```bash
$ cd week5 && make run
(eval):1: /usr/local/bin/poetry: bad interpreter: /usr/local/opt/python@3.10/bin/python3.10: no such file or directory
```

---

## ğŸ”¬ è¯Šæ–­æ­¥éª¤

### Step 1: æ£€æŸ¥ Poetry Shebang

**å‘½ä»¤**ï¼š
```bash
cat /usr/local/bin/poetry | head -5
```

**å‘ç°**ï¼š
```
#!/usr/local/opt/python@3.10/bin/python3.10
```

**é—®é¢˜**ï¼š
- Poetry æŒ‡å‘ `/usr/local/opt/python@3.10/`
- è¯¥ç›®å½•å·²è¢« Homebrew åˆ é™¤
- **ç»“è®ºï¼šPoetry ç ´ç¢**

---

### Step 2: æ£€æŸ¥ Homebrew Python

**å‘½ä»¤**ï¼š
```bash
ls -la /usr/local/opt/ | grep python
```

**å‘ç°**ï¼š
```
lrwxr-xr-x  python -> ../Cellar/python@3.10/3.10.8
lrwxr-xr-x  python@3.10 -> ../Cellar/python@3.10/3.10.8
lrwxr-xr-x  python@3.11 -> ../Cellar/python@3.11/3.11.0
```

**é—®é¢˜**ï¼š
- ç¬¦å·é“¾æ¥æŒ‡å‘ `/usr/local/Cellar/python@3.10/`
- è¯¥ç›®å½•å·²è¢«åˆ é™¤
- **ç»“è®ºï¼šPython 3.10 è¢«å¸è½½ï¼Œä½†é“¾æ¥æœªæ›´æ–°**

---

### Step 3: æ£€æŸ¥ Conda

**å‘½ä»¤**ï¼š
```bash
conda --version
```

**é”™è¯¯**ï¼š
```
conda:6: command not found: __conda_exe
```

**åˆ†æ**ï¼š
- ä¸æ˜¯ "conda: command not found"
- è€Œæ˜¯ `__conda_exe` å‡½æ•°æ‰¾ä¸åˆ°
- **ç»“è®ºï¼šConda å·²å®‰è£…ä½†æœªåˆå§‹åŒ–**

**éªŒè¯**ï¼š
```bash
cat ~/.zshrc | grep -A5 "conda initialize"
```

**å‘ç°**ï¼š
```bash
__conda_setup="$('/Users/David/miniconda3/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
eval "$__conda_setup"
```

**ç»“è®º**ï¼š
- `.zshrc` ä¸­æœ‰ conda åˆå§‹åŒ–ä»£ç 
- å½“å‰ shell æ²¡æœ‰åŠ è½½ `.zshrc`
- **éœ€è¦æ‰‹åŠ¨ source conda**

---

### Step 4: æ£€æŸ¥ç³»ç»Ÿ Python

**å‘½ä»¤**ï¼š
```bash
which python python3
/usr/bin/python3 --version
```

**å‘ç°**ï¼š
```
python not found
/usr/bin/python3
Python 3.9.6
```

**é—®é¢˜**ï¼š
- ç³»ç»Ÿ Python æ˜¯ 3.9.6
- é¡¹ç›®éœ€è¦ >= 3.10
- **ç»“è®ºï¼šç³»ç»Ÿ Python ä¸æ»¡è¶³è¦æ±‚**

---

### Step 5: æ£€æŸ¥ Conda ç¯å¢ƒ

**å‘½ä»¤**ï¼š
```bash
/Users/David/miniconda3/bin/conda env list
```

**å‘ç°**ï¼š
```
# conda environments:
base                     /Users/David/miniconda3
cs146s                   /Users/David/miniconda3/envs/cs146s
```

**éªŒè¯**ï¼š
```bash
/Users/David/miniconda3/envs/cs146s/bin/python --version
```

**ç»“æœ**ï¼š
```
Python 3.12.12
```

**ç»“è®º**ï¼š
- âœ… cs146s ç¯å¢ƒå·²å­˜åœ¨
- âœ… Python 3.12.12 æ»¡è¶³è¦æ±‚
- **åªæ˜¯æ²¡æœ‰æ¿€æ´»**

---

## ğŸ“Š è¯Šæ–­æ€»ç»“è¡¨

| ç»„ä»¶ | çŠ¶æ€ | é—®é¢˜ | æ ¹æœ¬åŸå›  |
|------|------|------|----------|
| **Python 3.10** | âŒ å·²åˆ é™¤ | Homebrew æ¸…ç†æ—§ç‰ˆæœ¬ | å®šæœŸç»´æŠ¤åˆ é™¤äº†æ—§åŒ… |
| **Poetry** | âŒ ç ´ç¢ | Shebang æŒ‡å‘ä¸å­˜åœ¨çš„ Python | Poetry ä¸ä¼šè‡ªåŠ¨æ›´æ–° shebang |
| **Conda** | âš ï¸ æœªåˆå§‹åŒ– | å½“å‰ shell æœªåŠ è½½ | éœ€è¦æ‰‹åŠ¨ source æˆ–æ–°ç»ˆç«¯ |
| **cs146s ç¯å¢ƒ** | âœ… å­˜åœ¨ | æœªæ¿€æ´» | éœ€è¦è¿è¡Œ `conda activate` |
| **ç³»ç»Ÿ Python** | âš ï¸ ç‰ˆæœ¬å¤ªæ—§ | 3.9.6 < 3.10 | macOS è‡ªå¸¦ç‰ˆæœ¬è¾ƒæ—§ |

---

## ğŸ¯ æ ¹æœ¬åŸå› åˆ†æ

### ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™äº›é—®é¢˜ï¼Ÿ

#### 1. **Poetry Shebang é—®é¢˜**

**åŸç†**ï¼š
```python
#!/usr/local/opt/python@3.10/bin/python3.10  # å†™æ­»åœ¨å®‰è£…æ—¶
import sys
from poetry.console.application import main
```

**é—®é¢˜**ï¼š
- Poetry å®‰è£…æ—¶ï¼Œshebang è¢«å†™æ­»ä¸ºå½“å‰çš„ Python è·¯å¾„
- å½“ Python è¢«åˆ é™¤/æ›´æ–°ï¼Œshebang ä¸ä¼šè‡ªåŠ¨æ›´æ–°
- ç±»ä¼¼äº"ç¡¬ç¼–ç "è·¯å¾„

**ç±»æ¯”**ï¼š
å°±åƒä½ åœ¨ GPS ä¸­è®¾ç½®äº†ä¸€ä¸ªåœ°å€ï¼Œä½†é‚£ä¸ªå»ºç­‘ç‰©è¢«æ‹†é™¤äº†ï¼ŒGPS è¿˜åœ¨æŒ‡å‘é‚£ä¸ªä½ç½®ã€‚

#### 2. **Conda æœªåˆå§‹åŒ–é—®é¢˜**

**åŸç†**ï¼š
```bash
# ~/.zshrc ä¸­
__conda_setup="$('/Users/David/miniconda3/bin/conda' 'shell.zsh' 'hook')"
eval "$__conda_setup"  # å®šä¹‰ conda å‡½æ•°
```

**é—®é¢˜**ï¼š
- Conda é€šè¿‡ä¿®æ”¹ `.zshrc` æ¥åˆå§‹åŒ–
- åªæœ‰åŠ è½½ `.zshrc` çš„ shell æ‰æœ‰ `conda` å‘½ä»¤
- å½“å‰ shellï¼ˆVSCode é›†æˆç»ˆç«¯ï¼‰å¯èƒ½æ²¡æœ‰åŠ è½½

**ç±»æ¯”**ï¼š
å°±åƒä½ å®‰è£…äº†ä¸€ä¸ªåº”ç”¨ï¼Œä½†æ²¡æœ‰åœ¨æ¡Œé¢åˆ›å»ºå¿«æ·æ–¹å¼ï¼Œä½ éœ€è¦æ¯æ¬¡æ‰‹åŠ¨æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚

#### 3. **Python ç‰ˆæœ¬æ··ä¹±**

**å†å²**ï¼š
```
2022å¹´ï¼šå®‰è£… Python 3.10ï¼ˆHomebrewï¼‰+ Poetry
2023å¹´ï¼šå®‰è£… Miniconda + cs146s ç¯å¢ƒ
2024å¹´ï¼šHomebrew åˆ é™¤ Python 3.10
ç°åœ¨ï¼šPoetry æŒ‡å‘å·²åˆ é™¤çš„ Python
```

**é—®é¢˜**ï¼š
- ç³»ç»Ÿä¸Šæœ‰å¤šä¸ª Pythonï¼ˆç³»ç»Ÿ 3.9, Homebrew 3.11, Conda 3.12ï¼‰
- Poetry ä»åœ¨ä½¿ç”¨æ—§çš„ Homebrew Python 3.10
- æ²¡æœ‰ç»Ÿä¸€çš„åŒ…ç®¡ç†

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆ 1: ä¿®å¤ Poetryï¼ˆé‡‡ç”¨ï¼‰

**æ­¥éª¤**ï¼š
1. æ¿€æ´» conda ç¯å¢ƒï¼ˆPython 3.12ï¼‰
2. ç”¨è¿™ä¸ª Python é‡æ–°å®‰è£… Poetry
3. Poetry çš„æ–° shebang å°†æŒ‡å‘ conda çš„ Python

**å‘½ä»¤**ï¼š
```bash
source ~/miniconda3/etc/profile.d/conda.sh
conda activate cs146s
curl -sSL https://install.python-poetry.org | python3 -
```

**åŸç†**ï¼š
- Poetry å®‰è£…æ—¶ï¼Œshebang æŒ‡å‘å½“å‰æ´»åŠ¨çš„ Python
- æ‰€ä»¥å…ˆç”¨ `conda activate` ç¡®ä¿æ­£ç¡®çš„ Python

### æ–¹æ¡ˆ 2: æ°¸ä¹…åˆå§‹åŒ– Condaï¼ˆæœªé‡‡ç”¨ï¼‰

**æ­¥éª¤**ï¼š
```bash
conda init zsh
```

**ä¸ºä»€ä¹ˆä¸é‡‡ç”¨ï¼Ÿ**
- ä¼šåœ¨æ¯ä¸ª shell ä¸­åˆå§‹åŒ– condaï¼ˆå¢åŠ å¯åŠ¨æ—¶é—´ï¼‰
- ä¸æ˜¯æ‰€æœ‰äººéƒ½éœ€è¦ conda
- æ›´çµæ´»çš„åšæ³•æ˜¯ç”¨åˆ«åæŒ‰éœ€æ¿€æ´»

---

## ğŸ“ è¯Šæ–­æ€ç»´æ¡†æ¶

### æˆ‘æ˜¯å¦‚ä½•æ€è€ƒçš„ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§‚å¯Ÿï¼šé”™è¯¯ä¿¡æ¯                          â”‚
â”‚  "bad interpreter: python3.10"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‡è®¾ 1ï¼šPython 3.10 ä¸å­˜åœ¨             â”‚
â”‚  éªŒè¯ï¼šls /usr/local/opt/python@3.10     â”‚
â”‚  ç»“æœï¼šâœ… ç¡®è®¤ä¸å­˜åœ¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‡è®¾ 2ï¼šPoetry æŒ‡å‘é”™è¯¯çš„ Python        â”‚
â”‚  éªŒè¯ï¼šcat /usr/local/bin/poetry         â”‚
â”‚  ç»“æœï¼šâœ… ç¡®è®¤ shebang é”™è¯¯              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‡è®¾ 3ï¼šéœ€è¦æ‰¾åˆ°æ­£ç¡®çš„ Python           â”‚
â”‚  éªŒè¯ï¼šæ£€æŸ¥ conda ç¯å¢ƒ                   â”‚
â”‚  ç»“æœï¼šâœ… æ‰¾åˆ° Python 3.12.12            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§£å†³æ–¹æ¡ˆï¼šç”¨æ­£ç¡®çš„ Python é‡è£… Poetry    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®è¯Šæ–­æŠ€å·§

1. **ä»é”™è¯¯ä¿¡æ¯å…¥æ‰‹**
   - "bad interpreter" â†’ shebang é—®é¢˜
   - "command not found" â†’ PATH é—®é¢˜
   - "No module named" â†’ ä¾èµ–é—®é¢˜

2. **éªŒè¯å‡è®¾**
   - ä¸è¦çŒœæµ‹ï¼Œç”¨å‘½ä»¤éªŒè¯
   - `ls`, `cat`, `which`, `file` ç­‰åŸºç¡€å·¥å…·

3. **æ‰¾åˆ°æ ¹æœ¬åŸå› **
   - Poetry ç ´ç¢ â†’ å› ä¸º Python è¢«åˆ é™¤
   - Python è¢«åˆ é™¤ â†’ å› ä¸º Homebrew æ¸…ç†
   - Conda æœªåˆå§‹åŒ– â†’ å› ä¸º shell æ²¡æœ‰åŠ è½½ .zshrc

4. **è®¾è®¡å¯å¤ç”¨çš„è§£å†³æ–¹æ¡ˆ**
   - ä¸ä»…ä»…ä¿®å¤å½“å‰é—®é¢˜
   - åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬é¢„é˜²æœªæ¥é—®é¢˜
   - è®°å½•è¯Šæ–­è¿‡ç¨‹ä¾›å‚è€ƒ

---

## ğŸ’¡ å¦‚æœæˆ‘å†æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Ÿ

### è¯Šæ–­æ¸…å•

```bash
# 1. æ£€æŸ¥é”™è¯¯ç±»å‹
file $(which poetry)           # æ£€æŸ¥æ–‡ä»¶ç±»å‹å’Œ shebang
head -1 $(which poetry)        # æŸ¥çœ‹ shebang

# 2. æ£€æŸ¥ä¾èµ–æ˜¯å¦å­˜åœ¨
ls -la /usr/local/opt/python*  # æ£€æŸ¥ Homebrew Python
which python python3           # æ£€æŸ¥ PATH ä¸­çš„ Python

# 3. æ£€æŸ¥ç¯å¢ƒ
conda env list                 # åˆ—å‡ºæ‰€æœ‰ conda ç¯å¢ƒ
pyenv versions                 # åˆ—å‡ºæ‰€æœ‰ pyenv ç¯å¢ƒ

# 4. æ£€æŸ¥é…ç½®
echo $PATH                     # æ£€æŸ¥ PATH
cat ~/.zshrc | grep python     # æ£€æŸ¥ shell é…ç½®
```

### å¿«é€Ÿä¿®å¤æ¨¡å¼

```bash
# å¦‚æœ Poetry ç ´ç¢
curl -sSL https://install.python-poetry.org | python3 -

# å¦‚æœ Conda æœªåˆå§‹åŒ–
source ~/miniconda3/etc/profile.d/conda.sh

# å¦‚æœç¯å¢ƒä¸å­˜åœ¨
conda create -n cs146s python=3.12 -y

# å¦‚æœä¾èµ–ç¼ºå¤±
poetry install
```

---

## ğŸ“š ç›¸å…³æ¦‚å¿µ

### Shebang

```python
#!/usr/local/opt/python@3.10/bin/python3.10
# â†‘ å‘Šè¯‰ç³»ç»Ÿç”¨ä»€ä¹ˆè§£é‡Šå™¨è¿è¡Œè¿™ä¸ªè„šæœ¬
```

### ç¬¦å·é“¾æ¥ï¼ˆSymlinkï¼‰

```bash
lrwxr-xr-x  python -> ../Cellar/python@3.10/3.10.8
# â†‘ python æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å®é™…ä½ç½®
```

### Shell åˆå§‹åŒ–

```bash
# å½“æ‰“å¼€æ–°ç»ˆç«¯æ—¶
1. è¯»å– /etc/zshrc
2. è¯»å– ~/.zshrc
3. æ‰§è¡Œå…¶ä¸­çš„å‘½ä»¤ï¼ˆå¦‚ conda initï¼‰
4. è®¾ç½® PATHã€åˆ«åã€å‡½æ•°ç­‰
```

---

**è¯Šæ–­æ—¶é—´**ï¼šçº¦ 5 åˆ†é’Ÿ
**è§£å†³æ—¶é—´**ï¼šçº¦ 10 åˆ†é’Ÿ
**è‡ªåŠ¨åŒ–å**ï¼š5 ç§’ï¼ˆ`python scripts/env_check.py`ï¼‰

**æ•ˆç‡æå‡**ï¼š**99%** ğŸš€
